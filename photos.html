<body>
  <main class="container">

    <div class="logo-wrap">
      <img src="Delcocup%20logo.png" alt="Delco Cup Logo" class="logo">
    </div>

    <h1>Photos</h1>

    <!-- Upload Section -->
    <section class="card">
      <h2>Delco Cup Photos</h2>
      <p class="small">Upload a photo or view the full gallery.</p>

      <div class="button-row">
        <a class="btn" target="_blank"
           href="https://www.dropbox.com/request/4l9paOEDZwa7gl8U2I31">
          Upload Photo
        </a>

        <a class="btn secondary" target="_blank"
           href="https://www.dropbox.com/scl/fo/b0hvhi5od49qil9c4e76p/AAsV8bh1eYgjJ2p1feFLmkg?rlkey=zuesmdykiy1dpfz2yrr5jm2gh&dl=0">
          View Gallery
        </a>
      </div>
    </section>

    <!-- Live Gallery -->
    <section class="card">
      <h2>Live Gallery</h2>
      <p class="small" id="statusText">Loadingâ€¦</p>
      <div id="photo-grid" class="photo-grid"></div>
    </section>

  </main>

  <script>
    const API = "https://morning-pine-c289.hz7rv6p2c8.workers.dev";

    async function loadPhotos() {
      const grid = document.getElementById("photo-grid");
      const status = document.getElementById("statusText");

      grid.innerHTML = "";

      try {
        const res = await fetch(API + "/list", { cache: "no-store" });
        const data = await res.json();

        if (!data.photos || data.photos.length === 0) {
          status.textContent = "No photos yet.";
          return;
        }

        status.textContent = data.photos.length + " items";

        data.photos.forEach(p => {
          const img = document.createElement("img");
          img.src = p.thumb;
          img.alt = p.name;
          img.loading = "lazy";
          grid.appendChild(img);
        });

      } catch (e) {
        console.error(e);
        status.textContent = "Error loading photos.";
      }
    }

    loadPhotos();
  </script>

</body>
